<api context="/hospital" name="PatientRegistrationAPI" xmlns="http://ws.apache.org/ns/synapse">
    <resource methods="POST" uri-template="/register">
        <inSequence>
            <log category="INFO">
                <message>Hello ${payload}</message>
            </log>
            
            <!-- Generate timestamp -->
            <variable expression="get-property('SYSTEM_TIME')" name="timestamp" type="STRING"/>
            <!-- Aggregate firstName,lastName-->
            <variable name="Name" type="STRING" expression="${payload.firstName + ' ' + payload.lastName}"/>
            <log category="INFO" logMessageID="false" logFullPayload="false">
                <message>Name is ${vars.Name}</message>
            </log><!-- Enhance payload -->
            <payloadFactory media-type="xml">
                <format>
                    <patientRegistration xmlns="">
                        <timestamp>${vars.timestamp}</timestamp>
                        <patientName>${vars.Name}</patientName>
                    </patientRegistration>
                </format>
            </payloadFactory>
            <respond/>
        </inSequence>
        <faultSequence>
            <payloadFactory media-type="json">
                <format>
                    {
                    "status": "error",
                    "message": "An error occurred while processing the registration"
                    }
                </format>
            </payloadFactory>
            <respond/>
        </faultSequence>
    </resource>
</api>
